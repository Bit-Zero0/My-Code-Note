
![[Pasted image 20220515121627.png]]
# 1.操作系统的运行机制和体系结构
## OS的运行机制和体系结构
### 运行机制
运行机制包括 ==**指令**==，==**处理器状态**== 和 ==**程序**== 。

#### 两种指令
指令包括两种：==**特权指令**== 和 **==非特权指令==**。
>* ==特权指令== : 不允许用户直接使用的命令，比如：V○指令、置中断指令、存取用于内存保护的寄存器、送程序状态字到程序状态寄存器、内存清零等的指令
>* ==非特权指令== :加减乘除等普通运算指令




#### 两种处理器状态


==**核心态（管态）**==：特权指令和非特权指令==都可==执行。


==**用户态（目态）**==：只能执行==非特权==指令。

>用程序状态寄存器PSW中的某标志位来标识处理器处于什么状态如：**`0`用户态**，**`1`核心态**



#### 两种程序

==**内核程序(管理程序)**==:操作**系统内核程序**是**系统管理者**，**特权**指令和**非特权**指令**都可**执行，运行在**核心态**。

==**用户程序(应用程序)**==:为了**保证系统能够安全运行**，==用户程序==只能执行==非特权指令==，运行在==用户态==。 


### 操作系统内核
**内核**是计算机配置在**底层的软件**，是**操作系统最基本最核心的部分**；==实现操作系统内核功能的程序是内核程序==

==**时钟管理(最基本功能)**== : **第一功能**用于**计时**：向用户提供标准的系统时间；==通过时钟中断管理，可以实现进程的切换==。
>例如：分时操作系统中采用时间片轮转制度；实时操作系统中按截至时间控制运行；批处理系统中通过时钟管理来衡量一个作业的运行程度等

==**中断机制(最甚本功能)** ==： **初衷**是为了**提高多道程序运行环境中汇总cpu的利用率**；后成为操作系统各操作的基础；
>例如：键盘或鼠标信息的输入；进程的管理和调度；系统功能的调用、设备驱动、文件访问等



==**原语(最基本功能)**==：
- 系统中的**设备驱动**、**cpu切换**、**进程通信**等功能中的部分操作都可定义为原语。
- 特点：
	- 是一种特殊的程序，处于操作系统最底层，是最接近硬件的部分
	- 这种程序的运行具有==原子性==，其操作一气呵成（主要从==系统安全性==和==便于管理==考虑）。
	- 程序运行时间都较短，调用频繁


==**对资源进行管理的功能**==

分为 **进程管理** ，**存储器管理** ,  **设备管理**

>**进程管理**: 进程状态管理、进程调度和分派、创建与撤销进程控制块等
>**存储器管理** : 存储器的空间分配和回收、内存信息保护程序、代码对换程序等
> **设备管理** : 缓冲区管理、设备分配和回收等


### 操作系统的体系结构

![[Pasted image 20220513193255.png]]

#### 大内核
将==内核的**主要功能模块**==都作为一个紧密联系的整体运行在**核心态**。

>优点：高性能
>缺点：内核代码庞大，结构混乱，难以维护



#### 微内核
将**内核中最基本的保留在内核**，而将那些不需要运行在==核心态==执行的功能**转移到**==用户态==执行

>优点：内核功能少，结构清晰，方便维护
>缺点：需要频繁在用户态和核心态之间切换，性能低



# 2.操作系统体系结构类比
类比：
操作系统的体系结构问题与企业的管理问题很相似。
>**内核**就是企业的==管理层==，负责一些重要的工作。
>只有**管理层才能执行特权指令**，**普通员工**只能执行**非特权指令**。
>**用户态**、**核心态**之间的切换相当于==普通员工和管理层之间的工作交接==。

>==**大内核**==：企业初创时体量不大，管理层的人会负责大部分的事情。优点是效率高；缺点是组织结构混乱，难以维护。
>==**微内核**==：随着企业体量越来越大，管理层只负责最核心的一些工作。优点是组织结构清晰，方便维护：缺点是效率低。




# 3.操作系统用户态和核心态的转换
遗留问题：用户态、核心态之间的切换是怎么实现的？

答：“==**用户态→核心态**==”是通过==**中断**==实现的。并且==**中断**是唯一途径==。

“**==核心态→用户态==**”的切换是通过 **==执行一个特权指令==**，将程序状态字(PSW)的标志位设置为“用户态'' 。






